<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="author" content="Adrian Mejia">
    <link rel="author" href="humans.txt" />
    <meta name="description" content="JavaScript tutorials and web development articles including topics like NodeJS, Angular, VueJS, Data Structures and Algorithms.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">

    <link rel="alternative" href="/atom.xml" title="Adrian Mejia Blog" type="application/atom+xml">

    
    <title>Understanding JavaScript Callbacks and best practices | Adrian Mejia Blog</title>

    <!-- Favicons -->
    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="/favicon-128.png" sizes="128x128" />
    <meta name="application-name" content="Adrian Mejia's Blog"/>
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="/mstile-310x310.png" />
    <meta name="msapplication-notification" content="frequency=30;polling-uri=http://notifications.buildmypinnedsite.com/?feed=https://adrianmejia.com/atom.xml" />

    <link rel="canonical" href="https://adrianmejia.com/callbacks-concurrency-in-javascript-node/" />
    <!-- Open Graph -->
    <meta property="og:url" content="https://adrianmejia.com/callbacks-concurrency-in-javascript-node/" />
    <meta property="og:site_name" content="Adrian Mejia Blog" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="Callbacks are one of the critical elements to understand JavaScript and Node.js. Nearly, all the asynchronous functions use a callback (or promises). In this post, we are going to cover callbacks in-depth and best practices." />
    <meta property="og:image" content="https://adrianmejia.com/images/callbacks-concurrency-in-javascript-large.png" />
    <meta property="og:title" content="Understanding JavaScript Callbacks and best practices" />
    <meta property="fb:app_id" content="761831487293468" />
    <meta property="fb:admins" content="895685163"/>
    <!-- /Open Graph -->

    <script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-24183929-4', 'auto');
ga('send', 'pageview');
</script><script async defer src='https://www.google-analytics.com/analytics.js'></script>


    <!-- Critical Styles -->
    <style media="screen">
      .overlay { display: none }
    </style>
    
<link rel="stylesheet" href="/stylesheets/main.css">

    <!-- loadDeferredStyles -->
    <noscript id="deferred-styles">
      
<link rel="stylesheet" href="/stylesheets/font-awesome.min.css">
    </noscript>

    <script>
      var loadDeferredStyles = function() {
        var addStylesNode = document.getElementById("deferred-styles");
        var replacement = document.createElement("div");
        replacement.innerHTML = addStylesNode.textContent;
        document.body.appendChild(replacement)
        addStylesNode.parentElement.removeChild(addStylesNode);
      };
      var raf = requestAnimationFrame || mozRequestAnimationFrame ||
          webkitRequestAnimationFrame || msRequestAnimationFrame;
      if (raf) raf(function() { window.setTimeout(loadDeferredStyles, 0); });
      else window.addEventListener('load', loadDeferredStyles);
    </script>

  <meta name="generator" content="Hexo 5.0.2"></head>
  <body>
    <header class="titlebar mdl-shadow--2dp">
      <div class="container align-center flexbox--space-between">
        <!-- <div class="row"> -->
          <!-- <div class="col-md-12"> -->
            <span class="hidden-mobile-up">
              <i class="fa fa-bars" aria-hidden="true"></i>
            </span>

            <a href="/" class="align-center m-y-2">
              <img src="/images/adrianmejia-logo.png" alt="Adrian Mejia Logo" class="animation--bounce-in"/>
              <h1 class="hidden-mobile-down hidden">
                Adrian Mejia
              </h1>
            </a>

            <nav class="hidden-mobile-down navbar">
              
                <a href="/#home" class="animation--radial-out" id="Home" onclick="track('/#home', 'menu', true)">Home</a>
              
                <a href="/#trending-posts" class="animation--radial-out" id="Trending" onclick="track('/#trending-posts', 'menu', true)">Trending</a>
              
                <a href="/#popular-posts" class="animation--radial-out" id="Popular" onclick="track('/#popular-posts', 'menu', true)">Popular</a>
              
                <a href="/#about" class="animation--radial-out" id="About" onclick="track('/#about', 'menu', true)">About</a>
              
                <a href="/blog/" class="animation--radial-out" id="Blog" onclick="track('/blog/', 'menu', true)">Blog</a>
              
            </nav>

            <a href="#" id="search-modal" onclick="track('#search', 'search', true)" class="open-overlay">
  <i class="fa fa-search" aria-hidden="true"></i>
</a>

<div id="search-overlay" class="overlay" aria-hidden="true">

  <script id="movie" type="text/x-handlebars-template">
    <article class="movie">
      {{#photos.0}}
      <a href="/{{path}}">
        <img class="movie-image" src="{{photos.0}}" />
      </a>
      {{/photos.0}}

      <div class="movie-meta">
        <div class="movie-title">
          <a href="/{{path}}">
            {{{_highlightResult.title.value}}}
          </a>
          <span class="movie-year">
            {{updatedYear}}
          </span>
        </div>

        <div class="movie-rating">
          {{#stars}}
            <span class="ais-star-rating--star{{^.}}__empty{{/.}}">
            </span>
          {{/stars}}
        </div>

        <p>
          {{{_highlightResult.excerptStrip.value}}}
        </p>

        <div class="movie-genres">
          {{#tags}}
            <div class="movie-genre">
              {{.}}
            </div>
          {{/tags}}
        </div>
      </div>
    </article>
  </script>

  <div class="search-container">

    <div class="top">
      <div class="search-button">
        <i class="fa fa-search"></i>
      </div>
      <div class="input-container">
        <input type="text" id="search-box" />
        <div id="stats"></div>
      </div>
      <a href="#" class="close-overlay">
        <i class="fa fa-times"></i>
      </a>
    </div>

    <div class="content">
      <div class="facets">

        <div class="facet">
          <div id="clear-all" class="facet-title"></div>
        </div>

        <div class="facet">
          <div class="facet-title">
            <i class="fa fa-tags" aria-hidden="true"></i> Tags
          </div>
          <div id="tags"></div>
        </div>

        <div class="facet">
          <div class="facet-title">
            <i class="fa fa-folder-o" aria-hidden="true"></i>
            Categories
          </div>
          <div id="categories"></div>
        </div>

        <div class="facet">
          <div class="facet-title">
            <i class="fa fa-eye" aria-hidden="true"></i>
            Views
          </div>
          <div id="ratings"></div>
        </div>

        <div class="facet">
          <div class="facet-title">
            <i class="fa fa-calendar" aria-hidden="true"></i>
            Year
          </div>
          <div id="year"></div>
        </div>
      </div>

      <div class="canvas">
        <div id="hits"></div>

        <div id="pagination"></div>

        <div>Powered by <img src="/images/Algolia_logo_bg-white.svg" height="30" alt="Algolia search"></div>
      </div>
    </div>
  </div>
</div>


<script src="/js/search.babel.js"></script>


      </div>
    </header>
    <nav class="hidden-mobile-up mdl-shadow--2dp">
      <div class="container flexbox--space-between navbar">
        
          <a href="/#home" class="animation--underline-from-center">Home</a>
        
          <a href="/#trending-posts" class="animation--underline-from-center">Trending</a>
        
          <a href="/#popular-posts" class="animation--underline-from-center">Popular</a>
        
          <a href="/#about" class="animation--underline-from-center">About</a>
        
          <a href="/blog/" class="animation--underline-from-center">Blog</a>
        
      </div>
    </nav>

    <main>
      <!--https://developers.google.com/search/docs/data-types/articles-->
<!--http://schema.org/BlogPosting-->
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": ""
  },
  "headline": "Understanding JavaScript Callbacks and best practices",
  
  "image": {
    "@type": "ImageObject",
    "url": "https://adrianmejia.com/images/callbacks-concurrency-in-javascript-large.png",
    "height": 360,
    "width": 728
  },
  
  "datePublished": "2019-07-03T19:06:12-04:00",
  "dateModified": "2019-07-03T19:06:12-04:00",
  "author": {
    "@type": "Person",
    "name": "Adrian Mejia"
  },
   "publisher": {
    "@type": "Organization",
    "name": "Adrian Mejia",
    "logo": {
      "@type": "ImageObject",
      "url": "https://adrianmejia.com/images/logo.png",
      "width": 347,
      "height": 50
    }
  },
  "description": "Callbacks are one of the critical elements to understand JavaScript and Node.js. Nearly, all the asynchronous functions use a callback (or promises). In this post, we are going to cover callbacks in-depth and best practices."
}
</script>


<article class="container post">

  <section class="hero">
    <div class="muted">
      <a class="category-link" href="/categories/coding/">Coding</a>
    </div>

    <h1>Understanding JavaScript Callbacks and best practices</h1>

    <div class="muted">
      <span title="Last time this post was updated">
        <i class="fa fa-calendar" aria-hidden="true"></i>
        Last updated
        <time datetime="2019-07-03T23:06:12.000Z" itemprop="dateUpdated">July 3rd 2019</time>
      </span>

      
        <span class="m-x-2" title="Pageviews">
          <i class="fa fa-eye" aria-hidden="true"></i>
          11.8k
        </span>
      

      <span class="m-x-2" title="Click to go to the comments section">
        <a href="#disqus_thread">
          <i class="fa fa-comment-o" aria-hidden="true"></i>
          <span class="disqus-comment-count" data-disqus-url="https://adrianmejia.com/callbacks-concurrency-in-javascript-node/">0</span>
        </a>
      </span>

      
        <span>
          <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/" rel="tag">nodejs</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tutorial-async-javascript/" rel="tag">tutorial_async-javascript</a><span class="tag-list-count">3</span></li></ul>
        </span>
      
    </div>
  </section>

  <div class="art-container" style="background-color: #FBE000">
    
      <picture>
        <source media="(min-width: 728px)" srcset="/images/callbacks-concurrency-in-javascript-large.png">
        <source srcset="/images/callbacks-concurrency-in-javascript-small.png">
        <img src="/images/callbacks-concurrency-in-javascript-large.png" alt="Understanding JavaScript Callbacks and best practices">
      </picture>
    
  </div>

  <div class="row">
    <section class="col-sm-8 p-x-2">

      <div class="post-content  toc-content ">
        <p>Callbacks are one of the critical elements to understand JavaScript and Node.js. Nearly, all the asynchronous functions use a callback (or promises). In this post, we are going to cover callbacks in-depth and best practices.</p>
<a id="more"></a>

<p>This post assumes you know the <a href="/asynchronous-vs-synchronous-handling-concurrency-in-javascript">difference between synchronous and asynchronous code</a>.</p>
<p>JavaScript is an event-driven language. Instead of waiting for things to happen, it executes while listening for events. The way you respond to an event is using callbacks.</p>
<hr>

<p><strong>Related Posts:</strong></p>
<ol>
<li><a href="/asynchronous-vs-synchronous-handling-concurrency-in-javascript/">Async vs Sync in JavaScript</a></li>
<li><a href="/callbacks-concurrency-in-javascript-node/">JavaScript Callbacks</a> (this one)</li>
<li><a href="/promises-tutorial-concurrency-in-javascript-node/">JavaScript Promises</a></li>
</ol>
<hr>

<h2 id="JavaScript-callbacks"><a href="#JavaScript-callbacks" class="headerlink" title="JavaScript callbacks"></a>JavaScript callbacks</h2><blockquote>
<p>A callback is a function that is passed as an argument to another function.</p>
</blockquote>
<p>Callbacks are also known as <strong>higher-order function</strong>.</p>
<p>An example of a callback is the following:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compute = <span class="function">(<span class="params">n1, n2, callback</span>) =&gt;</span> callback(n1, n2);</span><br><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">n1, n2</span>) =&gt;</span> n1 + n2;</span><br><span class="line"><span class="keyword">const</span> product = <span class="function">(<span class="params">n1, n2</span>) =&gt;</span> n1 * n2;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(compute(<span class="number">5</span>, <span class="number">3</span>, sum));     <span class="comment">// ↪️  8</span></span><br><span class="line"><span class="built_in">console</span>.log(compute(<span class="number">5</span>, <span class="number">3</span>, product)); <span class="comment">// ↪️  15</span></span><br></pre></td></tr></table></figure>

<p>As you can see the function <code>compute</code> takes two numbers and a callback function. This <code>callback</code> function can be <code>sum</code>, <code>product</code> and any other that you develop that operates two numbers.</p>
<h2 id="Callback-Advantages"><a href="#Callback-Advantages" class="headerlink" title="Callback Advantages"></a>Callback Advantages</h2><p>Callbacks can help to make your code more maintainable if you use them well. They will also help you to:</p>
<ul>
<li>Keep your code DRY (Do Not Repeat Yourself)</li>
<li>Implement better abstraction where you can have more generic functions like <code>compute</code> that can handle all sorts of functionalities (e.g., <code>sum</code>, <code>product</code>)</li>
<li>Improve code readability and maintainability.</li>
</ul>
<p>So far, we have only seen callbacks that are executed immediately; however, most of the callbacks in JavaScript are tied to an event like a timer, API request or reading a file.</p>
<h2 id="Asynchronous-callbacks"><a href="#Asynchronous-callbacks" class="headerlink" title="Asynchronous callbacks"></a>Asynchronous callbacks</h2><blockquote>
<p>An asynchronous callback is a function that is passed as an argument to another function <em>and gets invoke zero or multiple times after certain events happens</em>.</p>
</blockquote>
<p>It’s like when your friends tell you to call them back when you arrive at the restaurant. You coming to the restaurant is the “event” that <em>triggers</em> the callback. Something similar happens in the programming world. The event could be you click a button, a file is loaded into memory, and request to a server API, and so on.</p>
<p>Let’s see an example with two callbacks:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;tick ⏰&#x27;</span>), <span class="number">1e3</span>);</span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="built_in">clearInterval</span>(id), <span class="number">5e3</span>);</span><br></pre></td></tr></table></figure>

<p>First, you notice that we are using anonymous functions (in the previous example, we were passing the named functions such as <code>sum</code> and <code>product</code>). The callback passed to <code>setInterval</code> is triggered every second, and it prints <code>tick</code>. The second callback is called one after 5 seconds. It cancels the interval, so it just writes <code>tick</code> five times.</p>
<blockquote>
<p>Callbacks are a way to make sure a particular code doesn’t execute until another has already finished.</p>
</blockquote>
<p>The <code>console.log(&#39;tick&#39;)</code> only gets executed when a second has passed.</p>
<p>The functions <code>setInterval</code> and <code>setTimeout</code> callbacks are very simple. They don’t provide any parameters on the callback functions. But, if we are reading from the file system or network, we can get the response as a callback parameter.</p>
<h2 id="Callback-Parameters"><a href="#Callback-Parameters" class="headerlink" title="Callback Parameters"></a>Callback Parameters</h2><p>The callback parameters allow you to get messages into your functions when they are available. Let’s say we are going to create a vanilla server on Node.js.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> port = <span class="number">1777</span>;</span><br><span class="line"><span class="keyword">const</span> host = <span class="string">&#x27;127.0.0.1&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = http.createServer(<span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.writeHead(<span class="number">200</span>, &#123; <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;text/plain&#x27;</span> &#125;);</span><br><span class="line">  res.end(<span class="string">`Hello World from Node! You used url &quot;<span class="subst">$&#123;req.url&#125;</span>&quot;\r\n`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">proxy.listen(port, host, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server running on http://<span class="subst">$&#123;host&#125;</span>:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>We have two callbacks here. The <code>http.createServer</code>‘s callback sends the parameters (<code>req</code>)uest and (<code>res</code>)ponse every time somebody connects to the server.</p>
<p>You can test this server using curl (or browser)</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 127.0.0.1:1777/this/is/cool</span><br></pre></td></tr></table></figure>

<p>There you have it! An HTTP server that replies to everyone that connects to it using a callback. But, What would happen if there’s an error? Let’s see how to handle that next.</p>
<h2 id="Handling-errors-with-Node-js-callbacks"><a href="#Handling-errors-with-Node-js-callbacks" class="headerlink" title="Handling errors with Node.js callbacks"></a>Handling errors with Node.js callbacks</h2><p>Some callbacks send errors on the first parameter and then the data (<code>callback(error, data)</code>). That’s very common in Node.js API.
Let’s say we want to see all the directories on a given folder:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">fs.readdir(<span class="string">&#x27;/Users/adrian/Code&#x27;</span>, <span class="function">(<span class="params">error, files</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (error) &#123; <span class="built_in">console</span>.error(error); &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(files);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>As you notice, the first parameter will have an error message. If you run it, you would probably have the error message (unless you have the same name and directory).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; [Error: ENOENT: no such file or directory, scandir &#39;&#x2F;Users&#x2F;noAdrian&#x2F;Code&#39;]</span><br><span class="line">  errno: -2,</span><br><span class="line">  code: &#39;ENOENT&#39;,</span><br><span class="line">  syscall: &#39;scandir&#39;,</span><br><span class="line">  path: &#39;&#x2F;Users&#x2F;noAdrian&#x2F;Code&#39; &#125;</span><br><span class="line">undefined</span><br></pre></td></tr></table></figure>

<p>So that’s how you handle errors, you check for that parameter. But (there’s always a but) what if I need to do multiple async operations. The easiest way (but not the best) is to have a callback inside a callback:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dir = <span class="string">&#x27;/Users/adrian/Code&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printFilesSize</span>(<span class="params">basePath</span>) </span>&#123;</span><br><span class="line">  fs.readdir(basePath, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Error finding files: <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      files.forEach(<span class="function">(<span class="params">filename</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> filePath = <span class="string">`<span class="subst">$&#123;basePath&#125;</span>/<span class="subst">$&#123;filename&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">        fs.lstat(filePath, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (err) &#123; <span class="built_in">console</span>.error(err); &#125;</span><br><span class="line">          <span class="keyword">if</span> (stat.isFile()) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(filePath, stat.size.toLocaleString());</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printFilesSize(dir);</span><br></pre></td></tr></table></figure>

<p>As you can see, this program will first read files in a directory and then check the file size of each file, and if it’s a directory, it will be omitted.</p>
<p>When callbacks are nested too many levels deep, we call this callback hell! 🔥 Or the pyramid of doom ⚠️</p>
<p><img src="/images/callback-hell.gif" alt="callback hell"></p>
<p>Because they are hard to maintain, how do we fix the callback hell? Read on!</p>
<h2 id="Callback-Hell-problem-and-solutions"><a href="#Callback-Hell-problem-and-solutions" class="headerlink" title="Callback Hell problem and solutions"></a>Callback Hell problem and solutions</h2><p>Callback hell is when you have too many nested callbacks.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  b(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    c(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      d();</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>To make your code better, you should:</p>
<ol>
<li>Keep you code shallow (avoid too many nested functions): keep your code at 1-3 indentation levels.</li>
<li>Modularize: convert your anonymous callbacks into named functions.</li>
<li>Use promises and async/await.</li>
</ol>
<p>Let’s fix the callback hell from <code>printFilesSize</code> keeping our code shallow and modularizing it.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dir = <span class="string">&#x27;/Users/adrian/Code&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printFileSize</span>(<span class="params">filePath</span>) </span>&#123;</span><br><span class="line">  fs.lstat(filePath, <span class="function">(<span class="params">err, stat</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123; <span class="built_in">console</span>.error(err); &#125;</span><br><span class="line">    <span class="keyword">if</span> (stat.isFile()) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(filePath, stat.size.toLocaleString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printFilesSize</span>(<span class="params">files, basePath</span>) </span>&#123;</span><br><span class="line">  files.forEach(<span class="function">(<span class="params">filename</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> filePath = <span class="string">`<span class="subst">$&#123;basePath&#125;</span>/<span class="subst">$&#123;filename&#125;</span>`</span>;</span><br><span class="line"></span><br><span class="line">    printFileSize(filePath);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printFilesSizeFromDirectory</span>(<span class="params">basePath</span>) </span>&#123;</span><br><span class="line">  fs.readdir(basePath, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`Error finding files: <span class="subst">$&#123;err&#125;</span>`</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      printFilesSize(files, basePath);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">printFilesSizeFromDirectory(dir);</span><br></pre></td></tr></table></figure>

<p>The original implement had five levels of indentation, now that we modularized it is 1-2 levels.</p>
<p>Callbacks are not the only way to deal with asynchronous code. In the following post we are going to cover:</p>
<ul>
<li>Promises</li>
<li>Async/Await</li>
<li>Generators</li>
</ul>
<p>Stay tuned!</p>
<hr>

<p><strong>Related Posts:</strong></p>
<ol>
<li><a href="/asynchronous-vs-synchronous-handling-concurrency-in-javascript/">Async vs Sync in JavaScript</a></li>
<li><a href="/callbacks-concurrency-in-javascript-node/">JavaScript Callbacks</a> (this one)</li>
<li><a href="/promises-tutorial-concurrency-in-javascript-node/">JavaScript Promises</a></li>
</ol>
<hr>

      </div>

      <!-- after post -->
      <div class="hidden-mobile-down">
        <h3>Now, your turn!</h3>
        Thanks for reading this far. Here are some things you can do next:

        <ul>
          <li>Found a typo?
            <a target="_blank" rel="noopener" href="https://github.com/amejiarosario/amejiarosario.github.io/edit/source/source/_posts/2019-07-03-callbacks-concurrency-in-javascript-node.md">
              Edit this post</a>.
          </li>
          <li>Got questions?
            <a href="#comments-section">comment</a>
            below.
          </li>
          <li>
            Was it useful? Show your
            <!-- <a href="/support">support</a>  -->
            support and share it.
            <!-- <a target="_blank" href="http://paypal.me/amejiarosario">Paypal</a>, -->
            <!-- <a target="_blank" href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&hosted_button_id=HZLFWQAFENN7W&source=url">Paypal</a>,
            <a target="_blank" href="https://bitaps.com/3A8xanut3wddz1jJ7JWSw8nwwpUahLJpZi">Bitcoin</a>,
            <a target="_blank" href="https://www.patreon.com/amejiarosario">Patreon</a>. -->
          </li>
        </ul>
      </div>

      <div class="hidden-mobile-up">
        <a target="_blank" rel="noopener" href="https://books.adrianmejia.com">
          <!-- <img src="/images/data-structure-algorithms-javascript-presell.jpg" alt="Data Structure and Algorithms in JavaScript eBook"> -->
          <img src="/images/data-structure-algorithms-banner.jpg" alt="Data Structure and Algorithms in JavaScript eBook">
        </a>
      </div>

      <!-- Next and previous posts -->
      
        <div class="article-nav m-y-4">
          
            <a href="/promises-tutorial-concurrency-in-javascript-node/" class="article-nav-newer" class="article-nav-link-wrap">
              <strong class="article-nav-caption"><i class="fa fa-chevron-left"></i> newer</strong>
              <div class="article-nav-title">
                
                  The JavaScript Promise Tutorial
                
              </div>
            </a>
          
          
            <a href="/asynchronous-vs-synchronous-handling-concurrency-in-javascript/" class="article-nav-older" class="article-nav-link-wrap">
              <strong class="article-nav-caption">older <i class="fa fa-chevron-right"></i></strong>
              <div class="article-nav-title">What every programmer should know about Synchronous vs. Asynchronous Code</div>
            </a>
          
        </div>
      

      

        <!-- Related -->
        <footer>
          <!-- subscribe -->
          <div class="m-y-4">
            <!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
	   We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="//adrianmejia.us2.list-manage.com/subscribe/post?u=2294bb28c5931a6f2338d2474&amp;id=52678e825b" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Subscribe &amp; stay up to date!</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_2294bb28c5931a6f2338d2474_52678e825b" tabindex="-1" value=""></div>
    <div class="clear">&nbsp;<input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<!--End mc_embed_signup-->

<script type="text/javascript">
  var form = document.getElementById('mc-embedded-subscribe-form');
  form.addEventListener('submit', function(event) {
    event.preventDefault();
    ga('send', 'event', 'newsletter', 'signup', 'page', {
      hitCallback: createFunctionWithTimeout(function() {
        form.submit();
      })
    });
  });
</script>

          </div>

          <!-- Author Bio -->
          <b>About the author</b>
          
              <!-- Adrian Mejia Bio -->
            
<section class="bio-box">
  <img class="m-a-1 not-scaled" src="/images/adrian-mejia-headshot.png" alt="Adrian Mejia">
  <article class="p-x-1" style="display: flex; flex-direction:column;">
    <p class="muted">Adrian Mejia is a Software Engineer located in Boston, MA.
      Currently working at Google.
      Adrian enjoys writing posts about Algorithms, programming, JavaScript, and Web Dev.
      Also, he likes to travel ✈️ and biking 🚴‍.
      <!-- Find out more <a href="/#about">here</a>. -->
    </p>
    <!-- <p class="m-y-0"><a target="_blank" rel="noopener" href="https://twitter.com/iAmAdrianMejia">Follow him on Twitter</a>.</p> -->
    <a target="_blank" rel="noopener" href="https://twitter.com/iAmAdrianMejia" id="twitter-follow-button" class="twitter-follow-button" data-show-count="false">Follow @iAmAdrianMejia</a>&nbsp;
  </article>
</section>

          

          <div class="m-y-4">
            
              
                <div class="container">
                <h1 class="capitalize">tutorial async javascript Series</h1>
                <div class="row">
              

              <!-- <ol> -->
              <article class="col-md-6 col-sm-6 card">
  <a href="/asynchronous-vs-synchronous-handling-concurrency-in-javascript/">
    
      <img src="/images/async-vs-sync-concurrency-in-javascript-small.png" width="300" height="250">
      <section class="p-a-1">
        <h3>What every programmer should know about Synchronous vs. Asynchronous Code</h3>
      </section>
    
  </a>
</article>

              <!-- </ol> -->

              
            
              

              <!-- <ol> -->
              <article class="col-md-6 col-sm-6 card">
  <a href="/callbacks-concurrency-in-javascript-node/">
    
      <img src="/images/callbacks-concurrency-in-javascript-small.png" width="300" height="250">
      <section class="p-a-1">
        <h3>Understanding JavaScript Callbacks and best practices</h3>
      </section>
    
  </a>
</article>

              <!-- </ol> -->

              
            
              

              <!-- <ol> -->
              <article class="col-md-6 col-sm-6 card">
  <a href="/promises-tutorial-concurrency-in-javascript-node/">
    
      <img src="/images/promises-concurrency-in-javascript-small.png" width="300" height="250">
      <section class="p-a-1">
        <h3>The JavaScript Promise Tutorial</h3>
      </section>
    
  </a>
</article>

              <!-- </ol> -->

              
              </div><!-- .row -->
              </div><!-- .container -->
              
            
          </div>

          <!-- 726x88 -->
          <!---->
          <!--<script data-cfasync="false" type="text/javascript" src="(DISABLED)//www.eboundservices.com/ads/728x90_non_responsive.js"></script>-->
<!--           <div class="hidden-mobile-down">
            <script data-cfasync="false" type="text/javascript" src="(DISABLED)//www.eboundservices.com/ads/728x90_responsive.js"></script>
          </div> -->
          <!--<script data-cfasync="false" type="text/javascript" src="//www.eboundservices.com/ads/336x280_responsive.js"></script>-->


          <!-- last working ads -->
          <!-- <script data-cfasync="false" type="text/javascript" src="//www.eboundservices.com/ads/dfp/336x280_responsive.js"></script> -->


        </footer>

      <!-- if(page.layout !== 'snippet') -->
    </section>

    <!-- Asides (Ads, TOC, ...) -->
    <aside class="col-sm-4 p-x-2 col-xs-order-1">
      <section>

        <!-- 300x250 -->
        <!---->
        <!--<script data-cfasync="false" type="text/javascript" src="//www.eboundservices.com/ads/300x250_non_responsive.js"></script>-->
        <!--<div class="hidden-mobile-down">-->
          <!--<script data-cfasync="false" type="text/javascript" src="//www.eboundservices.com/ads/300x250_responsive.js"></script>-->
        <!--</div>-->

        <!--<div class="hidden-mobile-up">-->
        <!--<script data-cfasync="false" type="text/javascript" src="//www.eboundservices.com/ads/336x280_responsive.js"></script>-->
        <!--</div>-->

        <!-- last working ads -->
        <!-- <script data-cfasync="false" type="text/javascript" src="//www.eboundservices.com/ads/dfp/336x280_responsive.js"></script> -->

      </section>

      <section class="sticky-element--start">
        <div class="muted">
          <div class="p-y-1">
            <a href="#" class=""><span id="back-to-top" title="Go back to the top of this page">
              <i class="fa fa-arrow-up"></i> Top
            </span></a>

            <a href="#" class="p-x-3" title="Improve this post" onclick="track('https://github.com/amejiarosario/amejiarosario.github.io/edit/source/source/_posts/2019-07-03-callbacks-concurrency-in-javascript-node.md')">
              <i class="fa fa-pencil"></i> Edit this post
            </a>
            <!-- <a href="#" title="Share this post"><i class="fa fa-share"></i> Share</a> -->
            <!--<div class="p-y-1">-->
              <!---->
              <!---->
              <!---->
              <!---->
            <!--</div>-->
          </div>

          
            <h3 class="toc-title">Contents</h3>
            <div>
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaScript-callbacks"><span class="toc-number">1.</span> <span class="toc-text">JavaScript callbacks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callback-Advantages"><span class="toc-number">2.</span> <span class="toc-text">Callback Advantages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Asynchronous-callbacks"><span class="toc-number">3.</span> <span class="toc-text">Asynchronous callbacks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callback-Parameters"><span class="toc-number">4.</span> <span class="toc-text">Callback Parameters</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Handling-errors-with-Node-js-callbacks"><span class="toc-number">5.</span> <span class="toc-text">Handling errors with Node.js callbacks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Callback-Hell-problem-and-solutions"><span class="toc-number">6.</span> <span class="toc-text">Callback Hell problem and solutions</span></a></li></ol>
            </div>

            <!-- 300x600 -->
            <!---->
            <!--<script data-cfasync="false" type="text/javascript" src="(DISABLED)//www.eboundservices.com/ads/300x600_non_responsive.js"></script>-->
            <div class="hidden-mobile-down">
              <!-- last working ads -->
              <!-- <script data-cfasync="false" type="text/javascript" src="//www.eboundservices.com/ads/dfp/160x600_responsive.js"></script> -->

              <a href="https://books.adrianmejia.com" target="_blank">
                <!-- <img src="/images/data-structure-algorithms-javascript-presell.jpg" alt="Data Structure and Algorithms in JavaScript eBook"> -->
                <img src="/images/data-structure-algorithms-banner.jpg" alt="Data Structure and Algorithms in JavaScript eBook">
              </a>
            </div>
          
        </div>
      </section>
    </aside>
  </div>

  <!-- comments -->
  <a id="comments-section"></a>
  <footer class="row sticky-element--end">
    <div class="col-xs-12">
      <section>
  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://adrianmejia.com/callbacks-concurrency-in-javascript-node/';
      this.page.identifier = 'https://adrianmejia.com/callbacks-concurrency-in-javascript-node/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = '//adrianmejia.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener">comments powered by Disqus.</a></noscript>
</section>

    </div>
  </footer>
</article>

    </main>

    <!-- uxa -->
    <!-- <img src="//data.uxeranalytics.com/image1.png?uxa=blog" id="pxl1"> -->
    <!-- <script async defer src="//data.uxeranalytics.com/uxa.js"></script> -->
    <!-- /uxa -->

    <footer class="page-footer">
      <div class="container">
        <div class="p-y-2">
          &copy; 2022 <a href="http://adrianmejia.com">Adrian Mejia</a>
          <span class="muted m-x-4" title="Sat Oct 22 2022 13:54:12 GMT-0400 (Eastern Daylight Time)">
            v.rk61qc
          </span>
        </div>
      </div>
    </footer>

    <!-- Scripts -->
    
<script src="/js/main.babel.js"></script>
    <script id="dsq-count-scr" src="//adrianmejia.disqus.com/count.js" async></script>
    <!-- Algolia Search -->
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/instantsearch.js/1/instantsearch.min.css" />
    <script src="//cdn.jsdelivr.net/instantsearch.js/1/instantsearch.min.js"></script>
    
<link rel="stylesheet" href="/stylesheets/55_search.css">



    <!-- social scripts -->
    <script async defer src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
    

    
      <!-- <script src="https://gumroad.com/js/gumroad.js"></script> -->

      <!-- adthis -->
      <script type="text/javascript">
        var addthis_config = {
          data_ga_property: 'UA-24183929-4',
          data_ga_social : true
        };
      </script>
      <script async defer type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-579cb31b46e2f7e6"></script>

      
<script src="/js/posts.babel.js"></script>
      
<script src="/js/posts2.babel.js"></script>
    
  </body>
</html>
